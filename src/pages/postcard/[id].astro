---
import Layout from "@/layouts/Layout.astro";
import { CldImage } from "astro-cloudinary";
---

<Layout title="Spookards">
  <main class="space-y-8">
    <div id="photo-container" class="mt-8 place-content-center">
      <CldImage
        id="photo-image"
        src=""
        alt=""
        class={`flex h-full w-full rounded-lg opacity-0 transition`}
      />
    </div>
  </main>
</Layout>

<script>
  import { getCldOgImageUrl } from "astro-cloudinary/helpers";
  const photo = document.querySelector("#photo-image") as HTMLImageElement;
  // get quote from local storage
  const quote = localStorage.getItem("quote");
  // transform quote to json
  const quoteJson = quote ? JSON.parse(quote) : null;

  console.log(quoteJson);

  const url = getCldOgImageUrl({
    src: quoteJson.publicId,
    effects: [
      {
        background: "rgb:010A44",
      },
      {
        color: "rgb:2A005F",
        colorize: "100",
      },
      {
        gradientFade: "symmetric",
      },
    ],
    overlays: [
      {
        publicId: quoteJson.publicId,
        width: 1200,
        height: 630,
        crop: "fill",
        effects: [{ opacity: 20 }],
      },
      {
        width: 1000,
        crop: "fit",
        text: {
          color: "white",
          fontFamily: "Merriweather",
          fontSize: 58,
          fontWeight: "bold",
          lineSpacing: 10,
          text: quoteJson.title,
        },
        position: {
          x: 50,
          y: 130,
          gravity: "south_west",
        },
      },
      {
        publicId: quoteJson.publicId,
        width: 1000,
        height: 2,
        effects: [
          {
            colorize: "100,co_white",
            opacity: 70,
          },
        ],
        position: {
          x: 50,
          y: 100,
          gravity: "south_west",
        },
      },
      {
        text: {
          color: "white",
          fontFamily: "Lato",
          fontSize: 37,
          fontWeight: "bold",
          text: quoteJson.author,
        },
        position: {
          x: 50,
          y: 50,
          gravity: "south_west",
        },
      },
    ],
  });

  photo.src = url;

  photo.onload = () => {
    photo.style.opacity = "1";
  };
</script>
